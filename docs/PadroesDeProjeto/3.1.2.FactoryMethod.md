# 3.1.2. Factory Method

## Introdução

O **Factory Method** é um padrão criacional que define uma interface para criar objetos, mas permite que as subclasses decidam qual classe instanciar. Este padrão delega a responsabilidade de instanciação para subclasses, promovendo o baixo acoplamento e facilitando a extensão do código.

## Contexto no Sei&PossoEnsinar

Na plataforma **Sei&PossoEnsinar**, diferentes tipos de conteúdo educacional podem ser criados: aulas ao vivo, vídeos gravados, artigos, exercícios práticos, entre outros. Cada tipo de conteúdo possui características específicas de criação, validação e apresentação. O Factory Method permite criar esses diferentes tipos de conteúdo de forma flexível e extensível.

## Problema

Ao criar conteúdos educacionais na plataforma, o código cliente não deveria conhecer os detalhes de implementação de cada tipo específico de conteúdo. Além disso:

- Novos tipos de conteúdo podem ser adicionados sem modificar o código existente
- A lógica de criação pode variar dependendo do tipo de conteúdo
- É necessário manter consistência na criação de objetos complexos

## Solução

Utilizar o padrão Factory Method para encapsular a lógica de criação de diferentes tipos de conteúdo educacional, permitindo que cada fábrica concreta implemente sua própria lógica de instanciação.

## Estrutura


<img width="582" height="603" alt="image" src="https://github.com/user-attachments/assets/aacae3f7-3cd5-4f27-b459-aa53e5f1ce9d" />



## Implementação em C#

### Produto - Classe Base Abstrata

```csharp
using System;
using System.Collections.Generic;

namespace SeiEPossoEnsinar.Dominio.Conteudo
{
    /// <summary>
    /// Classe base abstrata para todos os tipos de conteúdo educacional
    /// </summary>
    public abstract class ConteudoEducacional
    {
        public string Titulo { get; protected set; }
        public int AutorId { get; protected set; }
        public string Categoria { get; protected set; }
        public DateTime DataCriacao { get; protected set; }
        public int Visualizacoes { get; set; }
        public string Status { get; set; }

        protected ConteudoEducacional(string titulo, int autorId, string categoria)
        {
            Titulo = titulo;
            AutorId = autorId;
            Categoria = categoria;
            DataCriacao = DateTime.Now;
            Visualizacoes = 0;
            Status = "rascunho";
        }

        /// <summary>
        /// Valida se o conteúdo está pronto para publicação
        /// </summary>
        public abstract bool Validar();

        /// <summary>
        /// Retorna detalhes específicos do conteúdo
        /// </summary>
        public abstract Dictionary<string, object> ObterDetalhes();

        /// <summary>
        /// Gera uma prévia do conteúdo
        /// </summary>
        public abstract string RenderizarPreview();
    }
}
```

### Produtos Concretos

```csharp
using System;
using System.Collections.Generic;

namespace SeiEPossoEnsinar.Dominio.Conteudo
{
    /// <summary>
    /// Conteúdo tipo Aula ao Vivo
    /// </summary>
    public class AulaAoVivo : ConteudoEducacional
    {
        public DateTime Horario { get; set; }
        public int DuracaoMinutos { get; set; }
        public string Plataforma { get; set; }
        public string LinkSala { get; set; }
        public int ParticipantesMaximos { get; set; }

        public AulaAoVivo(string titulo, int autorId, string categoria,
                          DateTime horario, int duracaoMinutos, string plataforma)
            : base(titulo, autorId, categoria)
        {
            Horario = horario;
            DuracaoMinutos = duracaoMinutos;
            Plataforma = plataforma;
            LinkSala = null;
            ParticipantesMaximos = 50;
        }

        public override bool Validar()
        {
            if (string.IsNullOrWhiteSpace(Titulo) || Titulo.Length < 5)
                return false;

            if (Horario <= DateTime.Now)
                return false;

            if (DuracaoMinutos < 15 || DuracaoMinutos > 180)
                return false;

            return true;
        }

        public override Dictionary<string, object> ObterDetalhes()
        {
            return new Dictionary<string, object>
            {
                { "tipo", "Aula ao Vivo" },
                { "titulo", Titulo },
                { "horario", Horario.ToString("yyyy-MM-dd HH:mm:ss") },
                { "duracao", $"{DuracaoMinutos} minutos" },
                { "plataforma", Plataforma },
                { "vagas_disponiveis", ParticipantesMaximos },
                { "status", Status }
            };
        }

        public override string RenderizarPreview()
        {
            return $@"
AULA AO VIVO
Titulo: {Titulo}
Horario: {Horario:dd/MM/yyyy} as {Horario:HH:mm}
Duracao: {DuracaoMinutos} min
Vagas: {ParticipantesMaximos}
            ".Trim();
        }
    }

    /// <summary>
    /// Conteúdo tipo Vídeo Gravado
    /// </summary>
    public class VideoGravado : ConteudoEducacional
    {
        public string UrlVideo { get; set; }
        public int DuracaoSegundos { get; set; }
        public List<string> LegendasDisponiveis { get; set; }
        public bool PermiteDownload { get; set; }

        public VideoGravado(string titulo, int autorId, string categoria,
                           string urlVideo, int duracaoSegundos)
            : base(titulo, autorId, categoria)
        {
            UrlVideo = urlVideo;
            DuracaoSegundos = duracaoSegundos;
            LegendasDisponiveis = new List<string>();
            PermiteDownload = false;
        }

        public override bool Validar()
        {
            if (string.IsNullOrWhiteSpace(Titulo) || Titulo.Length < 5)
                return false;

            if (string.IsNullOrWhiteSpace(UrlVideo))
                return false;

            if (DuracaoSegundos < 60)
                return false;

            return true;
        }

        public override Dictionary<string, object> ObterDetalhes()
        {
            int minutos = DuracaoSegundos / 60;
            int segundos = DuracaoSegundos % 60;

            return new Dictionary<string, object>
            {
                { "tipo", "Video Gravado" },
                { "titulo", Titulo },
                { "url", UrlVideo },
                { "duracao", $"{minutos}:{segundos:D2}" },
                { "legendas", LegendasDisponiveis },
                { "download", PermiteDownload },
                { "status", Status }
            };
        }

        public override string RenderizarPreview()
        {
            int minutos = DuracaoSegundos / 60;
            return $@"
VIDEO GRAVADO
Titulo: {Titulo}
Duracao: {minutos} minutos
Download: {(PermiteDownload ? "Sim" : "Nao")}
            ".Trim();
        }
    }

    /// <summary>
    /// Conteúdo tipo Artigo de Texto
    /// </summary>
    public class ArtigoTexto : ConteudoEducacional
    {
        public string Conteudo { get; set; }
        public int TempoLeituraMinutos { get; set; }
        public List<string> Tags { get; set; }
        public List<string> Referencias { get; set; }

        public ArtigoTexto(string titulo, int autorId, string categoria,
                          string conteudo, int tempoLeituraMinutos)
            : base(titulo, autorId, categoria)
        {
            Conteudo = conteudo;
            TempoLeituraMinutos = tempoLeituraMinutos;
            Tags = new List<string>();
            Referencias = new List<string>();
        }

        public override bool Validar()
        {
            if (string.IsNullOrWhiteSpace(Titulo) || Titulo.Length < 5)
                return false;

            if (string.IsNullOrWhiteSpace(Conteudo) || Conteudo.Length < 100)
                return false;

            return true;
        }

        public override Dictionary<string, object> ObterDetalhes()
        {
            return new Dictionary<string, object>
            {
                { "tipo", "Artigo" },
                { "titulo", Titulo },
                { "palavras", Conteudo.Split(' ').Length },
                { "tempo_leitura", $"{TempoLeituraMinutos} min" },
                { "tags", Tags },
                { "status", Status }
            };
        }

        public override string RenderizarPreview()
        {
            string previewTexto = Conteudo.Length > 150
                ? Conteudo.Substring(0, 150) + "..."
                : Conteudo;

            return $@"
ARTIGO
Titulo: {Titulo}
Tempo de leitura: {TempoLeituraMinutos} min

{previewTexto}
            ".Trim();
        }
    }
}
```

### Factory - Classe Abstrata Creator

```csharp
using System;
using System.Collections.Generic;

namespace SeiEPossoEnsinar.Dominio.Factories
{
    /// <summary>
    /// Fábrica abstrata para criação de conteúdo educacional
    /// </summary>
    public abstract class ConteudoFactory
    {
        /// <summary>
        /// Factory Method que deve ser implementado pelas subclasses
        /// </summary>
        public abstract ConteudoEducacional CriarConteudo(Dictionary<string, object> dados);

        /// <summary>
        /// Template Method que usa o Factory Method
        /// </summary>
        public ConteudoEducacional PublicarConteudo(Dictionary<string, object> dados)
        {
            // Cria o conteúdo usando o factory method
            ConteudoEducacional conteudo = CriarConteudo(dados);

            // Valida o conteúdo
            if (!conteudo.Validar())
            {
                throw new InvalidOperationException(
                    $"Conteudo invalido: {conteudo.Titulo}");
            }

            // Atualiza status
            conteudo.Status = "publicado";

            // Aqui poderia ter lógica adicional:
            // - Enviar notificações
            // - Indexar para busca
            // - Registrar analytics

            Console.WriteLine($"Conteudo publicado: {conteudo.Titulo}");
            return conteudo;
        }
    }
}
```

### Factories Concretas

```csharp
using System;
using System.Collections.Generic;

namespace SeiEPossoEnsinar.Dominio.Factories
{
    /// <summary>
    /// Fábrica para criar aulas ao vivo
    /// </summary>
    public class AulaAoVivoFactory : ConteudoFactory
    {
        public override ConteudoEducacional CriarConteudo(Dictionary<string, object> dados)
        {
            var aula = new AulaAoVivo(
                titulo: (string)dados["titulo"],
                autorId: (int)dados["autor_id"],
                categoria: (string)dados["categoria"],
                horario: (DateTime)dados["horario"],
                duracaoMinutos: (int)dados["duracao_minutos"],
                plataforma: dados.ContainsKey("plataforma") 
                    ? (string)dados["plataforma"] 
                    : "Zoom"
            );

            // Configurações específicas de aula ao vivo
            if (dados.ContainsKey("participantes_maximos"))
            {
                aula.ParticipantesMaximos = (int)dados["participantes_maximos"];
            }

            // Gera link da sala
            aula.LinkSala = $"https://sala.seiepossoensinar.com/{aula.AutorId}/" +
                           $"{Math.Abs(aula.Titulo.GetHashCode())}";

            Console.WriteLine($"Aula ao vivo criada: {aula.Titulo}");
            return aula;
        }
    }

    /// <summary>
    /// Fábrica para criar vídeos gravados
    /// </summary>
    public class VideoGravadoFactory : ConteudoFactory
    {
        public override ConteudoEducacional CriarConteudo(Dictionary<string, object> dados)
        {
            var video = new VideoGravado(
                titulo: (string)dados["titulo"],
                autorId: (int)dados["autor_id"],
                categoria: (string)dados["categoria"],
                urlVideo: (string)dados["url_video"],
                duracaoSegundos: (int)dados["duracao_segundos"]
            );

            // Configurações específicas de vídeo
            if (dados.ContainsKey("permite_download"))
            {
                video.PermiteDownload = (bool)dados["permite_download"];
            }

            if (dados.ContainsKey("legendas"))
            {
                video.LegendasDisponiveis = (List<string>)dados["legendas"];
            }

            Console.WriteLine($"Video gravado criado: {video.Titulo}");
            return video;
        }
    }

    /// <summary>
    /// Fábrica para criar artigos de texto
    /// </summary>
    public class ArtigoTextoFactory : ConteudoFactory
    {
        public override ConteudoEducacional CriarConteudo(Dictionary<string, object> dados)
        {
            // Calcula tempo de leitura (média 200 palavras/min)
            string conteudo = (string)dados["conteudo"];
            int palavras = conteudo.Split(new[] { ' ' }, 
                StringSplitOptions.RemoveEmptyEntries).Length;
            int tempoLeitura = Math.Max(1, palavras / 200);

            var artigo = new ArtigoTexto(
                titulo: (string)dados["titulo"],
                autorId: (int)dados["autor_id"],
                categoria: (string)dados["categoria"],
                conteudo: conteudo,
                tempoLeituraMinutos: tempoLeitura
            );

            // Configurações específicas de artigo
            if (dados.ContainsKey("tags"))
            {
                artigo.Tags = (List<string>)dados["tags"];
            }

            if (dados.ContainsKey("referencias"))
            {
                artigo.Referencias = (List<string>)dados["referencias"];
            }

            Console.WriteLine($"Artigo criado: {artigo.Titulo}");
            return artigo;
        }
    }
}
```

## Exemplo de Uso

```csharp
using System;
using System.Collections.Generic;
using SeiEPossoEnsinar.Dominio.Conteudo;
using SeiEPossoEnsinar.Dominio.Factories;

namespace SeiEPossoEnsinar.Exemplos
{
    public class Program
    {
        public static void Main(string[] args)
        {
            Console.WriteLine("=".PadRight(60, '='));
            Console.WriteLine("EXEMPLO: Factory Method - Sei&PossoEnsinar");
            Console.WriteLine("=".PadRight(60, '='));

            // 1. Criar uma aula ao vivo
            Console.WriteLine("\n1. Criando Aula ao Vivo...");
            ConteudoFactory factoryAula = new AulaAoVivoFactory();

            var dadosAula = new Dictionary<string, object>
            {
                { "titulo", "Introducao ao C# para Iniciantes" },
                { "autor_id", 101 },
                { "categoria", "Programacao" },
                { "horario", DateTime.Now.AddDays(2) },
                { "duracao_minutos", 90 },
                { "plataforma", "Google Meet" },
                { "participantes_maximos", 30 }
            };

            ConteudoEducacional aula = factoryAula.PublicarConteudo(dadosAula);
            Console.WriteLine(aula.RenderizarPreview());
            ImprimirDetalhes(aula.ObterDetalhes());

            // 2. Criar um vídeo gravado
            Console.WriteLine("\n2. Criando Video Gravado...");
            ConteudoFactory factoryVideo = new VideoGravadoFactory();

            var dadosVideo = new Dictionary<string, object>
            {
                { "titulo", "Design Patterns em 10 Minutos" },
                { "autor_id", 102 },
                { "categoria", "Arquitetura de Software" },
                { "url_video", "https://videos.seiepossoensinar.com/dp-001" },
                { "duracao_segundos", 625 },
                { "permite_download", true },
                { "legendas", new List<string> { "pt-BR", "en-US" } }
            };

            ConteudoEducacional video = factoryVideo.PublicarConteudo(dadosVideo);
            Console.WriteLine(video.RenderizarPreview());
            ImprimirDetalhes(video.ObterDetalhes());

            // 3. Criar um artigo
            Console.WriteLine("\n3. Criando Artigo...");
            ConteudoFactory factoryArtigo = new ArtigoTextoFactory();

            string conteudoArtigo = @"
                Os princípios SOLID são cinco diretrizes fundamentais da programação 
                orientada a objetos que ajudam a criar sistemas mais manuteníveis e escaláveis.
                
                S - Single Responsibility Principle: Uma classe deve ter apenas uma razão para mudar.
                O - Open/Closed Principle: Aberto para extensão, fechado para modificação.
                L - Liskov Substitution Principle: Subtipos devem ser substituíveis por seus tipos base.
                I - Interface Segregation Principle: Clientes não devem depender de interfaces que não usam.
                D - Dependency Inversion Principle: Dependa de abstrações, não de implementações concretas.
            ";

            // Repetir para ter conteúdo suficiente
            conteudoArtigo = string.Concat(System.Linq.Enumerable.Repeat(conteudoArtigo, 10));

            var dadosArtigo = new Dictionary<string, object>
            {
                { "titulo", "SOLID: Principios da Programacao Orientada a Objetos" },
                { "autor_id", 103 },
                { "categoria", "Arquitetura de Software" },
                { "conteudo", conteudoArtigo },
                { "tags", new List<string> { "SOLID", "POO", "Clean Code", "Arquitetura" } },
                { "referencias", new List<string>
                    {
                        "Robert C. Martin - Clean Architecture",
                        "Martin Fowler - Refactoring"
                    }
                }
            };

            ConteudoEducacional artigo = factoryArtigo.PublicarConteudo(dadosArtigo);
            Console.WriteLine(artigo.RenderizarPreview());
            ImprimirDetalhes(artigo.ObterDetalhes());

            // 4. Uso polimórfico - lista de factories
            Console.WriteLine("\n4. Uso Polimorfico...");
            var factories = new Dictionary<string, ConteudoFactory>
            {
                { "aula", new AulaAoVivoFactory() },
                { "video", new VideoGravadoFactory() },
                { "artigo", new ArtigoTextoFactory() }
            };

            Console.WriteLine("\nTipos de conteudo disponiveis:");
            foreach (var item in factories)
            {
                Console.WriteLine($"  - {item.Key}: {item.Value.GetType().Name}");
            }

            Console.WriteLine("\n" + "=".PadRight(60, '='));
        }

        private static void ImprimirDetalhes(Dictionary<string, object> detalhes)
        {
            Console.WriteLine("\nDetalhes:");
            foreach (var item in detalhes)
            {
                Console.WriteLine($"  {item.Key}: {item.Value}");
            }
        }
    }
}
```

## Implementação Alternativa em Java

### Produto - Classe Base Abstrata (Java)

```java
package com.seiepossoensinar.dominio.conteudo;

import java.time.LocalDateTime;
import java.util.Map;

/**
 * Classe base abstrata para todos os tipos de conteúdo educacional
 */
public abstract class ConteudoEducacional {
    
    protected String titulo;
    protected int autorId;
    protected String categoria;
    protected LocalDateTime dataCriacao;
    protected int visualizacoes;
    protected String status;

    public ConteudoEducacional(String titulo, int autorId, String categoria) {
        this.titulo = titulo;
        this.autorId = autorId;
        this.categoria = categoria;
        this.dataCriacao = LocalDateTime.now();
        this.visualizacoes = 0;
        this.status = "rascunho";
    }

    /**
     * Valida se o conteúdo está pronto para publicação
     */
    public abstract boolean validar();

    /**
     * Retorna detalhes específicos do conteúdo
     */
    public abstract Map<String, Object> obterDetalhes();

    /**
     * Gera uma prévia do conteúdo
     */
    public abstract String renderizarPreview();

    // Getters e Setters
    public String getTitulo() { return titulo; }
    public int getAutorId() { return autorId; }
    public String getCategoria() { return categoria; }
    public LocalDateTime getDataCriacao() { return dataCriacao; }
    public int getVisualizacoes() { return visualizacoes; }
    public void setVisualizacoes(int visualizacoes) { 
        this.visualizacoes = visualizacoes; 
    }
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
}
```

### Factory - Classe Abstrata (Java)

```java
package com.seiepossoensinar.dominio.factories;

import com.seiepossoensinar.dominio.conteudo.ConteudoEducacional;
import java.util.Map;

/**
 * Fábrica abstrata para criação de conteúdo educacional
 */
public abstract class ConteudoFactory {

    /**
     * Factory Method que deve ser implementado pelas subclasses
     */
    public abstract ConteudoEducacional criarConteudo(Map<String, Object> dados);

    /**
     * Template Method que usa o Factory Method
     */
    public ConteudoEducacional publicarConteudo(Map<String, Object> dados) {
        // Cria o conteúdo usando o factory method
        ConteudoEducacional conteudo = criarConteudo(dados);

        // Valida o conteúdo
        if (!conteudo.validar()) {
            throw new IllegalStateException(
                "Conteudo invalido: " + conteudo.getTitulo());
        }

        // Atualiza status
        conteudo.setStatus("publicado");

        // Aqui poderia ter lógica adicional:
        // - Enviar notificações
        // - Indexar para busca
        // - Registrar analytics

        System.out.println("Conteudo publicado: " + conteudo.getTitulo());
        return conteudo;
    }
}
```

## Vantagens

1. **Baixo Acoplamento**: O código cliente não precisa conhecer as classes concretas
2. **Extensibilidade**: Novos tipos de conteúdo podem ser adicionados sem modificar código existente (Open/Closed Principle)
3. **Single Responsibility**: Cada factory tem uma única responsabilidade - criar um tipo específico de conteúdo
4. **Manutenibilidade**: Lógica de criação centralizada e organizada
5. **Testabilidade**: Facilita criar mocks e testes unitários

## Desvantagens

1. **Complexidade**: Adiciona mais classes ao sistema
2. **Overhead**: Pode ser excessivo para casos simples de criação
3. **Hierarquia**: Requer criação de hierarquias paralelas (produtos e creators)

## Quando Usar

- Quando a classe não sabe de antemão quais objetos concretos precisa criar
- Quando você quer delegar a responsabilidade de instanciação para subclasses
- Quando você quer fornecer uma biblioteca de classes e expor apenas suas interfaces
- Quando há lógica complexa de criação que varia entre diferentes tipos

## Padrões Relacionados

- **Abstract Factory**: Usa múltiplos Factory Methods para criar famílias de objetos relacionados
- **Template Method**: Factory Method é frequentemente chamado dentro de Template Methods
- **Prototype**: Alternativa ao Factory Method quando a criação por clonagem é mais adequada
- **Builder**: Mais complexo que Factory Method, usado quando a construção envolve múltiplos passos

| Versão | Data | Descrição | Autor(es) | Revisor(es) |
| :--- | :--- | :--- | :--- | :--- |
| 1.0 | 24/10/2025 | Criação da documentação  | Victor Câmara e Maria Eduarda|         |

