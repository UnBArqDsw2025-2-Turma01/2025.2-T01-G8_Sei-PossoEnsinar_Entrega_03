# 3.2.5. Proxy

## Introdução

Este documento detalha a aplicação do padrão de projeto Proxy no módulo de acesso a materiais didáticos do sistema, visando implementar uma camada de controle de segurança.

O padrão Proxy é classificado como um padrão Estrutural pelo Gang of Four (GoF) e é projetado para atuar como um substituto ou intermediário para um objeto real. O principal benefício é a capacidade de interceptar e gerenciar chamadas para o objeto original, permitindo a execução de lógica auxiliar, como validação de segurança, inicialização tardia de recursos, ou monitoramento, sem modificar a classe que contém a lógica de negócio principal.

No contexto deste sistema de ensino, o Proxy é utilizado como um Proxy de Proteção, garantindo que o acesso de um Aluno a um recurso valioso (Material) seja rigorosamente verificado antes da sua efetiva visualização.

-----

## Metodologia

A implementação do padrão Proxy seguiu uma metodologia focada em segurança e desacoplamento:

1. Requisito de Segurança: Identificação do requisito de que a visualização de um material (Material) deve ser condicionada ao status da participação do aluno (Aluno) na sessão de ensino associada.
2. Modelagem da Interface: Criação da interface AcessoMaterial, que define o contrato de visualização (+ visualizar()), isolando o Cliente (Aluno) da implementação concreta.
3. Desenho UML: Formalização da estrutura (conforme o diagrama fornecido) na notação UML, ilustrando a relação de herança entre ProxyMaterial e Material com a interface comum, e a Composição do ProxyMaterial sobre o Material real.
4. Definição da Lógica de Proteção: Estabelecimento dos atributos de controle (permissaoAtiva e statusSessao) e da lógica condicional dentro do ProxyMaterial.visualizar().
5. Elaboração do Documento: Redação e detalhamento da aplicação do padrão, justificando a escolha do Proxy de Proteção para este cenário.

-----

## Desenvolvimento

A aplicação do Proxy visa blindar o objeto Material contra acessos não autorizados ou fora do contexto adequado (ex: se o aluno não estiver matriculado na sessão).

**Estrutura do Proxy de Proteção**

O diagrama de classes reflete a estrutura canônica do Proxy, com uma função clara para cada componente na cadeia de acesso:

1. **Interface Comum (Subject):**
    - Elemento: <<Interface>> AcessoMaterial
    - Função: Estabelece o contrato que todos os envolvidos na visualização de um material devem obedecer, o método + visualizar(). O Aluno depende exclusivamente desta interface.
2. **Assunto Real (Real Subject):**
    - Elemento: Material
    - Função: Contém a lógica essencial de manipulação de dados (id, titulo, arquivo) e a operação crucial de carregamento do conteúdo (+ visualizar()). A responsabilidade desta classe é estritamente de conteúdo, e não de segurança.
3. **Proxy (Proxy):**
    - Elemento: ProxyMaterial
    - Função: É o substituto inteligente do Material. Implementa a AcessoMaterial para ser transparente ao Cliente. Possui a Composição para o objeto real (- realMaterial: Material).
    - Mecanismo de Proteção: O método + visualizar() do ProxyMaterial atua como um filtro:
        - Ele utiliza seus atributos de estado (permissaoAtiva: boolean, statusSessao: String) para executar verificações.
        - Controle de Fluxo: A chamada ao método realMaterial.visualizar() só é executada se todas as condições de segurança forem satisfeitas. Caso contrário, o Proxy bloqueia a delegação e, por exemplo, lança uma exceção ou retorna uma negação de acesso.
    - Método de Controle: O método + setPermissao(p: boolean) permite que alguma outra parte do sistema configure as credenciais de acesso para a próxima tentativa de visualização.
4. **Cliente (Client):**
    - Elemento: Aluno
    - Função: Utiliza o método + acessarMateriais(), que interage com a interface AcessoMaterial. O Aluno não sabe se está acessando o Material diretamente ou se o ProxyMaterial está intermediando o acesso.

**Vantagens da Implementação**
1. Coesão Preservada (SRP): A lógica complexa de verificar statusSessao e permissaoAtiva é confinada ao ProxyMaterial, mantendo a classe Material limpa e focada exclusivamente na gestão do recurso em si.
2. Flexibilidade na Proteção: Permite que novas regras de segurança (ex: checagem de timestamp da sessão) sejam adicionadas ao ProxyMaterial sem a necessidade de reescrever ou recompilar o código do Material.
3. Transparência e Modularidade: A separação através da interface AcessoMaterial garante que a inserção ou remoção do Proxy no sistema possa ser feita sem alterar o código de alto nível do Aluno.


-----

### Diagrama

<font size="2"><p style="text-align: center"><b>Figura 1:</b> Diagrama de Classes da aplicação do padrão Proxy</p></font>

<div style="text-align: center;">

![proxy](../images/DiagramaProxy.png)

</div>

<font size="2"><p style="text-align: center"><b>Autor:</b> <a href="https://github.com/leanars">Bruno Cruz e Anne de Capdeville</a>, 2025</p></font>

**Componentes e Fluxo de Interação (Padrão Proxy)**
O diagrama detalha os seguintes componentes e seu fluxo de interação no sistema de controle de acesso a materiais didáticos:

1. **Cliente (Client):**
    - Elemento: Aluno
    - Função: Representa a parte do sistema (o usuário) que tenta consumir o recurso. O Aluno interage com o recurso através do método + acessarMateriais(). O Aluno está desacoplado da lógica de segurança, pois ele interage apenas com a interface AcessoMaterial, sem saber se está lidando com o objeto real ou com o substituto (ProxyMaterial).

2. **Interface Comum (Subject):**
    - Elemento: <<Interface>> AcessoMaterial
    - Função: Define o contrato que o Cliente (Aluno) espera. O método principal é + visualizar(), que especifica a operação de acesso ao conteúdo. Tanto o objeto real (Material) quanto o seu representante (ProxyMaterial) implementarão esta interface, garantindo que possam ser usados de forma intercambiável pelo Aluno.

3. **Assunto Real (Real Subject):**
    - Elemento: Material
    - Função: Esta classe é a implementação concreta da interface AcessoMaterial e contém o recurso de valor e a lógica essencial de carregamento do conteúdo. Sua responsabilidade é realizar a operação de fato (+ visualizar()), que pode ser "pesada" (ex: carregar um arquivo grande). Esta classe está protegida e não contém lógica de segurança.

4. **Proxy (Proxy):**
    - Elemento: ProxyMaterial
    - Função: Esta é a peça central do padrão Proxy de Proteção. Também implementa a interface AcessoMaterial, permitindo que o Aluno interaja com ela como se fosse o Material real. O ProxyMaterial possui uma referência (- realMaterial: Material) para uma instância do Material.
    - Fluxo de Controle: O ProxyMaterial intercepta a chamada ao + visualizar() e, usando seus atributos de controle (permissaoAtiva: boolean, statusSessao: String), verifica se o Aluno possui as credenciais necessárias. Somente se as verificações passarem, ele delega a chamada ao realMaterial.


-----

## Histórico de Versões

| Versão | Data | Descrição | Autor(es) | Revisor(es) |
| :--- | :--- | :--- | :--- | :--- |
| 1.0 | 24/10/2025 | Criação da documentação | Anne de Capdeville | Bruno Cruz|
| 1.1 | 24/10/2025 | Documentação e criação do diagrama  | Anne de Capdeville e Bruno Cruz | Bruno Cruz |
