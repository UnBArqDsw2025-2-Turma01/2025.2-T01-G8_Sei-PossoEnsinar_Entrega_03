<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Padrão Mediator</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }
        h2, h3 { color: #2c3e50; }
        .code-block, .output-block {
            background-color: #f4f4f4;
            border-left: 5px solid #3498db;
            padding: 10px 15px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .output-block {
            background-color: #272822; /* Cor de terminal */
            color: #f8f8f2;
            border-left: 5px solid #1abc9c;
        }
        .code-title {
            font-family: monospace;
            font-weight: bold;
            color: #1abc9c;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }
        .figure {
            text-align: center;
            margin: 20px 0;
        }
        .figure img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
        }
        .figcaption {
            margin-top: 10px;
            font-size: 0.9em;
            color: #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #ecf0f1;
        }
    </style>
</head>
<body>

    <h2>3.3.3. Padrão Comportamental: Mediator</h2>

    <h3>Introdução</h3>
    <p>O <strong>Mediator</strong> é um padrão de projeto da Gang of Four (GoF) pertencente ao grupo dos padrões Comportamentais, cujo objetivo é centralizar a comunicação e a lógica de interação entre objetos, reduzindo o acoplamento direto entre eles. Dessa forma, os objetos (<code>Componentes</code>) não se comunicam diretamente uns com os outros, mas sim através de um objeto central: o <strong>Mediador</strong>.</p>
    <p>Este padrão é essencial em sistemas como o <strong>sei&possoensinar</strong>, onde há múltiplos componentes (usuários, sessões) que precisam interagir de maneira complexa (ex: um <code>Aluno</code> solicita algo, e um <code>Monitor</code> responde, o que desencadeia notificações). Ao utilizar o <code>TeachingMediator</code>, o sistema se torna mais organizado, facilitando a manutenção, a expansão e a compreensão do fluxo de comunicação entre os componentes.</p>
    <ul>
        <li><strong>Redução de Acoplamento:</strong> As classes de usuário (<code>Aluno</code>, <code>Monitor</code>) dependem apenas do Mediador, e não umas das outras.</li>
        <li><strong>Centralização do Controle:</strong> A lógica de negócio complexa (quem notificar após uma ação) é encapsulada em um único lugar.</li>
        <li><strong>Maior Reutilização:</strong> Os componentes se tornam mais simples e reutilizáveis, pois não contêm regras de interação com outros componentes.</li>
    </ul>

    <h3>Metodologia</h3>
    <p>Para o desenvolvimento e aplicação do padrão Mediator, foram adotadas as seguintes etapas metodológicas:</p>
    <table>
        <thead>
            <tr>
                <th>Ferramenta</th>
                <th>Finalidade</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Estudo Teórico</strong></td>
                <td>Utilização de materiais da Gang of Four e guias de orientação para fornecer embasamento sobre os princípios, estrutura e casos de uso do padrão Mediator.</td>
            </tr>
            <tr>
                <td><strong>Draw.io</strong></td>
                <td>Modelagem de um diagrama de classes para estruturar os elementos envolvidos (Interfaces, Componentes Abstratos e Concretos, e o Mediador), definindo suas relações e hierarquias.</td>
            </tr>
            <tr>
                <td><strong>NestJS/TypeScript</strong></td>
                <td>Utilização do framework e da linguagem para implementar a arquitetura do padrão no backend, aproveitando a tipagem estática para garantir a segurança e a clareza do fluxo de dados.</td>
            </tr>
            <tr>
                <td><strong>Testes de Fluxo</strong></td>
                <td>Elaboração de um <code>main.ts</code> de demonstração para validar o fluxo de comunicação entre o <code>Aluno</code> e o <code>Monitor</code> (via <code>TeachingMediator</code>), garantindo que a coordenação centralizada funcione conforme o esperado.</td>
            </tr>
        </tbody>
    </table>

    <h3>Desenvolvimento</h3>
    <p>O desenvolvimento do padrão Mediator focou na criação de um ponto central de orquestração de tarefas, o <strong><code>TeachingMediator</code></strong>, para gerenciar as interações essenciais do sistema:</p>
    <ol>
        <li><strong>Componentes (Entidades Ativas):</strong> As classes <code>Aluno</code> e <code>Monitor</code> foram definidas como componentes concretos, herdando de <code>Component.abstract.ts</code>. Isso garante que ambos tenham o método <code>notify()</code> disponível para enviar eventos ao mediador sem se referenciar mutuamente.</li>
        <li><strong>Lógica Centralizada no <code>TeachingMediator</code>:</strong> O mediador, ao receber um evento, coordena as etapas subsequentes, como notificar o <code>Monitor</code> após uma <code>solicitarInscricao</code> do <code>Aluno</code>.</li>
    </ol>
    <p>O resultado é um sistema mais simples e robusto. O fluxo de comunicação é controlado e gerenciável dentro da classe <code>TeachingMediator</code>, <strong>evitando que as classes de usuário fiquem acopladas umas às outras</strong> e facilitando futuras modificações nas regras de interação ou adição de novos tipos de usuários.</p>
    
    <div class="figure">
        <p>Figura 1 - Diagrama Mediator</p>
        <img src="images/mediator_diagrama.png" alt="Diagrama de Classes UML do Padrão Mediator">
        <p class="figcaption">Autor(es): Maria Eduarda e Victor, 2025.</p>
    </div>

    <h3>Resultado do Código</h3>
    <p>Abaixo está a saída do console (terminal) após a execução do arquivo <code>main.ts</code>, demonstrando o fluxo centralizado de comunicação através do <code>TeachingMediator</code>.</p>
    
    <div class="figure">
        <p>Figura 2 - Resultado do código</p>
        <img src="images/resultado_mediator.png" alt="resultado do código do Padrão Mediator">
        <p class="figcaption">Autor(es): Maria Eduarda e Victor, 2025.</p>
    </div>

    <h3>Código</h3>

    <div class="code-title">mediator.interface.ts</div>
    <div class="code-block">
        <pre>
import { Component } from "./component.abstract";

export interface TeachingMediator {
  notify(sender: Component, event: string, data?: any): void;
}
        </pre>
    </div>
    
    <div class="code-title">component.abstract.ts</div>
    <div class="code-block">
        <pre>
import { TeachingMediator } from "./mediator.interface";

export abstract class Component {
  constructor(protected mediator: TeachingMediator) {}

  abstract performAction(): void;
}
        </pre>
    </div>

    <div class="code-title">teaching.mediator.ts</div>
    <div class="code-block">
        <pre>
import { Component } from "./component.abstract";
import { TeachingMediator } from "./mediator.interface";
import { Aluno } from "./aluno.component";
import { Monitor } from "./monitor.component";
import { SessaoDeEnsinoComponent } from "./sessao.component";

export class TeachingMediator implements TeachingMediator {
  private alunos: Aluno[] = [];
  private monitors: Monitor[] = [];
  private sessoes: SessaoDeEnsinoComponent[] = [];

  registerComponent(component: Component): void {
    if (component instanceof Aluno) {
      this.alunos.push(component);
    } else if (component instanceof Monitor) {
      this.monitors.push(component);
    } else if (component instanceof SessaoDeEnsinoComponent) {
      this.sessoes.push(component);
    }
  }

  notify(sender: Component, event: string, data?: any): void {
    console.log(`\n[MEDIATOR] Evento: ${event} disparado por ${sender.constructor.name}`);

    switch (event) {
      case "solicitarInscricao":
        console.log(`[MEDIATOR] Processando solicitação de inscrição na Sessão ID: ${data.sessaoId}`);
        
        const monitorResponsavel = this.monitors[0];
        monitorResponsavel.receiveRequest(`Inscrição do ${sender.constructor.name} na sessão ${data.sessaoId}`);
        break;

      case "responderSolicitacao":
        console.log(`[MEDIATOR] Notificando Aluno sobre a resposta do Monitor: ${data.status}`);

        this.alunos.forEach(aluno => {
          aluno.receiveNotification(`Status da sua solicitação: ${data.status}`);
        });
        break;

      case "sessaoCriada":
        console.log(`[MEDIATOR] Nova sessão "${data.titulo}" criada. Iniciando match de interesse...`);
        this.alunos.forEach(aluno => {
          aluno.receiveNotification(`Nova sessão disponível: ${data.titulo}`);
        });
        break;

      default:
        console.log("[MEDIATOR] Nenhum fluxo de comunicação definido para este evento.");
    }
  }
}
        </pre>
    </div>

    <div class="code-title">aluno.component.ts</div>
    <div class="code-block">
        <pre>
import { Component } from "./component.abstract";

export class Aluno extends Component {
  constructor(mediator: any, private nome: string) {
    super(mediator);
  }

  performAction(): void {
    this.solicitarInscricao(101);
  }

  solicitarInscricao(sessaoId: number): void {
    console.log(`[ALUNO - ${this.nome}] Solicita inscrição na sessão ${sessaoId}`);
    this.mediator.notify(this, "solicitarInscricao", { sessaoId });
  }

  receiveNotification(message: string): void {
    console.log(`[ALUNO - ${this.nome}] NOTIFICAÇÃO RECEBIDA: ${message}`);
  }
}
        </pre>
    </div>

    <div class="code-title">monitor.component.ts</div>
    <div class="code-block">
        <pre>
import { Component } from "./component.abstract";

export class Monitor extends Component {
  constructor(mediator: any, private nome: string) {
    super(mediator);
  }

  performAction(): void {
    this.responderSolicitacao("aprovada");
  }

  receiveRequest(request: string): void {
    console.log(`[MONITOR - ${this.nome}] SOLICITAÇÃO RECEBIDA: ${request}. Processando...`);
    this.responderSolicitacao("Aprovada");
  }

  responderSolicitacao(status: 'Aprovada' | 'Rejeitada'): void {
    console.log(`[MONITOR - ${this.nome}] Responde solicitação com status: ${status}`);
    this.mediator.notify(this, "responderSolicitacao", { status });
  }
}
        </pre>
    </div>

    <div class="code-title">sessao.component.ts</div>
    <div class="code-block">
        <pre>
import { Component } from "./component.abstract";

export class SessaoDeEnsinoComponent extends Component {
  constructor(mediator: any, private titulo: string) {
    super(mediator);
  }

  performAction(): void {
    this.ofertaSessao();
  }

  ofertaSessao(): void {
    console.log(`[SESSAO - ${this.titulo}] Sessão oferecida e pronta para inscrições.`);
    this.mediator.notify(this, "sessaoCriada", { titulo: this.titulo });
  }
}
        </pre>
    </div>

    <div class="code-title">main.ts</div>
    <div class="code-block">
        <pre>
import { TeachingMediator } from "./teaching.mediator";
import { Aluno } from "./aluno.component";
import { Monitor } from "./monitor.component";
import { SessaoDeEnsinoComponent } from "./sessao.component";

// 1. Inicializa o Mediador
const mediator = new TeachingMediator();

// 2. Cria os Componentes (usuários)
const alunoMaria = new Aluno(mediator, "Maria");
const monitorJoao = new Monitor(mediator, "João");
const sessaoUML = new SessaoDeEnsinoComponent(mediator, "Modelagem UML");

// 3. Registra os componentes no mediador
mediator.registerComponent(alunoMaria);
mediator.registerComponent(monitorJoao);
mediator.registerComponent(sessaoUML);

console.log("--- CENÁRIO 1: Criação de Sessão ---");
sessaoUML.performAction(); 

console.log("\n--- CENÁRIO 2: Aluno solicita Inscrição ---");
alunoMaria.performAction();

console.log("\n--- CENÁRIO 3: Monitor responde Solicitação ---");
monitorJoao.performAction();
        </pre>
    </div>

    <h3>Histórico de Versões</h3>
    <table>
        <thead>
            <tr>
                <th>Versão</th>
                <th>Data</th>
                <th>Descrição</th>
                <th>Autor(es)</th>
                <th>Revisor(es)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>1.0</strong></td>
                <td>24/10/2025</td>
                <td>Criação do documento, adição da introdução, metodologia e desenvolvimento do padrão Mediator.</td>
                <td>Maria Eduarda e Victor</td>
                <td> </td>
            </tr>
        </tbody>
    </table>

</body>
</html>